<!doctype html>
<html>

<head>
  <title>TaggIt</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="vendors/jquery/jquery-2.1.0.js"></script>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <!-- Bootstrap material design -->
  <!-- https://cdn.rawgit.com/FezVrasta/bootstrap-material-design/gh-pages-v3/bootstrap-elements.html -->
  <!-- Material Design fonts -->
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/icon?family=Material+Icons">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/css/bootstrap-material-design.min.css" integrity="sha256-j3CLSRG31GkOu6kaeLh7XsRgL2YNvRl9aOtXoAYt320=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/css/ripples.min.css" integrity="sha256-+Og2qJI9qzvKYwhGo/LYXg0FzE1BhEQfDsUSjKXQ3Bg=" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/js/material.min.js" integrity="sha256-uZbIqasulk7Y9yEwknbeQ0FpF3aUhtPwuggbpvQaI8Y=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-material-design/0.5.10/js/ripples.min.js" integrity="sha256-TY/EO/++Ug/P+fSBjaqlmtuphCBKwlP7TOnS+SGnN8g=" crossorigin="anonymous"></script>

  <!-- Leaflet (http://leafletjs.com/) -->
  <link rel="stylesheet" href="vendors/leaflet/leaflet.css" />
  <script src="vendors/leaflet/leaflet.js"></script>

  <!-- Leaflet pulsating icon (https://github.com/mapshakers/leaflet-icon-pulse) -->
  <link rel="stylesheet" href="vendors/LeafletPulsingIcon/L.Icon.Pulse.min.css" />
  <script src="vendors/LeafletPulsingIcon/L.Icon.Pulse.min.js"></script>

  <!-- Knockout.js -->
  <!--
        Try out knockout ==> Binding for Leaflet: https://github.com/giabos/ko-leaflet/blob/master/ko-leaflet.js
        Maybe needed for Bootstrap as well: https://faulknercs.github.io/Knockstrap/
     -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js" integrity="sha256-owX7sroiO/O1a7h3a4X29A1g3QgqdNvijRQ7V5TH45M=" crossorigin="anonymous"></script>
  <script src="resources/js/ko-leaflet.js"></script>
  <script src="https://cdn.rawgit.com/faulknercs/Knockstrap/v1.3.2/build/knockstrap.min.js" type="tet/javascript"></script>

  <!-- Application code -->
  <script src="resources/js/GeoLocation.js"></script>
  <script src="resources/js/TripRepository.js"></script>

  <link rel="stylesheet" href="resources/css/page.css" />
  <link rel="stylesheet" href="resources/css/page-map.css" />
  <link rel="stylesheet" href="resources/css/category-tiles.css" />
  <link rel="stylesheet" href="resources/css/sidebar.css" />
  <link rel="stylesheet" href="resources/css/loadingSpinner.css" />
  <link rel="stylesheet" href="resources/css/glyphicon-util.css" />

  <script src="resources/js/controller/sidebar.js"></script>
  <script src="resources/js/controller/map.js"></script>

  <script type="text/html" id="sidebar-template">

    <div class="sidebar-wrapper">
      <ul class="sidebar-nav">
        <li class="sidebar-brand">
          <a href="#">Start Bootstrap</a>
        </li>
        <li>
          <a href="#">Dashboard</a>
        </li>
        <li>
          <a href="#">Shortcuts</a>
        </li>
        <li>
          <a href="#">Overview</a>
        </li>
        <li>
          <a href="#">Events</a>
        </li>
        <li>
          <a href="#">About</a>
        </li>
        <li>
          <a href="#">Services</a>
        </li>
        <li>
          <a href="#">Contact</a>
        </li>
      </ul>
    </div>
    <div class="overlay" data-bind="visible: isVisible, click: close"></div>
  </script>
  <script type="text/html" id="map-template">
    <div id="btn-center-map" class="btn-group" data-bind="visible: mapController.buttonsVisible, click: mapController.centerMapHandler">
      <a class="btn btn-primary btn-fab btn-raised">
        <i class="material-icons">my_location</i>
      </a>
    </div>
    <div id="btn-add-location" class="btn-group" data-bind="visible: mapController.buttonsVisible, click: mapController.addMarkerHandler">
      <a class="btn btn-primary btn-fab btn-raised">
        <i class="material-icons">add_location</i>
      </a>
    </div>
    <div data-bind="leafletMap: mapController, visible: mapController.mapVisible" class="map"></div>

    <p id="message" data-bind="text: messageContent"></p>
    <div data-bind="template: { name: 'loading-template', data: mapController.isInitialized }"></div>
    </div>
  </script>

  <!-- From: https://loading.io/ -->
  <script type="text/html" id="loading-template">
    <div class='uil-gps-css' style='margin-right: auto; margin-left: auto; transform:scale(0.4);' data-bind="visible: !$data">
      <div class="inner"></div>
      <div class="outer"></div>
      <div class="markers">
        <div class="markers-ib">
          <div class="marker"></div>
          <div class="marker"></div>
          <div class="marker"></div>
          <div class="marker"></div>
        </div>
      </div>
    </div>
  </script>
</head>

<body>
  <div id="mapView" class="page has-sidebar active" data-bind="css : { toggled : sidebarController.isVisible() }">
    <div data-bind="template: { name: 'sidebar-template', data: sidebarController }"></div>

    <div class="page-content-wrapper">
      <div id="header">
        <div class="row">
          <div class="col-xs-2 col-sm-1">
            <span id="toggleButton" class="glyphicon glyphicon-menu-hamburger btn btn-default gi-1_5x material-input" style="z-index:3000" data-bind="click: sidebarController.toggle"></span>
          </div>
          <!-- ko if:  mapController.filterbarVisible -->
          <div class="col-xs-7 col-sm-8" style="z-index:60;padding-right:0px">
            <input type="text" class="form-control" placeholder="Search..." />
          </div>
          <div class="col-xs-3 col-sm-3" style="z-index:60;padding-left:0px">
            <span class="glyphicon glyphicon-search navbar-btn btn btn-default gi-1_5x material-input" style="padding-right: 15px;"></span>

            <span class="glyphicon glyphicon-filter navbar-btn btn btn-default gi-1_5x material-input"></span>
          </div>
          <!-- /ko -->
        </div>
      </div>

      <div data-bind="template: { name: 'map-template', data: $data }"></div>
    </div>
  </div>

  <div id="addLocationView" class="page">
    <div class="page-content-wrapper">
      <div id="header">
        <div class="row">
          <div class="col-xs-2 col-sm-1">
            <span id="backbutton" class="material-icons material-input" style="z-index:3000; font-size: 3em" data-bind="click:addLocationController.backToMap">navigate_before</i>
            </div>
            <div class="col-xs-10 col-sm-11" style="z-index:60;padding-right:0px">
              <h2 style="margin-top: 5px">Add location</h2>
            </div>
          </div>
        </div>

        <div class="row" data-bind="foreach: addLocationController.categories, as category">
          <div class="thumbnail" data-bind="css: { selected: $root.addLocationController.locationData.category() == name }">
            <div class="content" data-bind="click:$root.addLocationController.selectCategory(name)">
              <span class="material-icons" data-bind="text:icon"></span>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div id="addLocationDetailsView" class="page">
    <div class="page-content-wrapper">
      <div id="header">
        <div class="row">
          <div class="col-xs-2 col-sm-1">
            <span id="backbutton" class="material-icons" style="z-index:3000; font-size: 3em" data-bind="click:addLocationController.backToSelectCategory">navigate_before</i>
            </div>
            <div class="col-xs-8 col-sm-9" style="z-index:60;padding-right:0px">
              <h2 style="margin-top: 5px">Add location</h2>
            </div>
            <div class="col-xs-2 col-sm-2" style="z-index:60;padding-right:0px">
              <span class="material-icons" style="font-size: 3em;">done</span>
          </div>
        </div>
      </div>

      <div class="container">
        <form>
          <div class="form-group form-group-lg label-floating">
            <label class="control-label" for="locationTitle">Title</label>
            <input type="text" class="form-control" id="locationTitle">
          </div>
          <div class="form-group label-floating">
            <label class="control-label" for="locationDescription">Description</label>
            <textarea class="form-control" id="locationDescription" rows="4"></textarea>
          </div>
          <div class="row">
            <div class="col-sm-2 col-xs-2">
              <span class="material-icons" style="font-size: 3em;" data-collapse-group="myDivs" data-toggle="collapse" data-target="#mapPreview" >place</span>
            </div>
            <div class="col-sm-2 col-xs-2">
              <span class="material-icons" style="font-size: 3em;" data-collapse-group="myDivs" data-toggle="collapse" data-target="#changeCategoryCollapse" data-bind="text: addLocationController.getCategoryIcon(addLocationController.locationData.category()), click: addLocationController.openPanelHandler"></span>
            </div>
            <div class="col-sm-2 col-xs-2">
              <span class="material-icons" style="font-size: 3em;" data-collapse-group="myDivs" data-toggle="collapse" data-target="#websiteCollapse" data-bind="click: addLocationController.openPanelHandler">language</span>
            </div>
          </div>
          <div id="mapPreview" class="collapse">
            <div class="panel panel-default">
              <div class="panel-body">
                MAP PREVIEW IN SMALL RECTANGLE
              </div>
            </div>
          </div>
          <div id="websiteCollapse" class="collapse">
            <div class="panel panel-default">
              <div class="panel-body">
                <div class="form-group label-floating">
                  <label class="control-label" for="url" style="margin-top:0px">Website</label>
                  <input type="url" class="form-control" id="url">
                </div>
              </div>
            </div>
          </div>
          <div id="changeCategoryCollapse" class="collapse">
            <div class="container-fluid">
              <div class="row">
                <div class="panel panel-default">
                  <div class="panel-body" data-bind="foreach: addLocationController.categories, as category">
                    <div class="thumbnail-3" data-bind="css: { selected: $root.addLocationController.locationData.category() == name }">
                      <div class="content" data-bind="click:$root.addLocationController.selectCategoryClosePanel(name)">
                        <span class="material-icons" data-bind="text:icon"></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="container-fluid">
            <div class="row">
              <div class="thumbnail-3-no-margin photo-tile">
                <div class="content">
                  <span class="material-icons">add_a_photo</span>
                </div>
              </div>
              <div class="thumbnail-3-no-margin photo-tile">
                <div class="content">
                  <span class="material-icons">add_a_photo</span>
                </div>
              </div>
              <div class="thumbnail-3-no-margin photo-tile">
                <div class="content">
                  <span class="material-icons">add_a_photo</span>
                </div>
              </div>
              <div class="thumbnail-3-no-margin photo-tile">
                <div class="content">
                  <span class="material-icons">add_a_photo</span>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>

      <nav class="navbar navbar-inverse navbar-fixed-bottom">
        <div class="container-fluid">
          <div class="row">
            <input class="btn btn-default col-xs-12 col-sm-12" type="button" value="New location" style="color:white" data-bind="click: addLocationController.backToMap">
          </div>
        </div>
      </nav>

    </div>
  </div>

  <script>
    var controller;

    function showPage(pageName) {
      $("div.page.active").removeClass("active");
      $("#" + pageName).addClass("active");
    }

    (function($) {
      // Use this class to add a ripple effect to a button
      // ==> Only useful when not changing pages since it is too slow to be visible before page changes
      $.material.options.ripples = ".withripple";
      $.material.init();

      function updateLocationGpsError(error) {
        GeoLocation.printError(error);
        controller.mapController.buttonsVisible(false);
        controller.mapController.mapVisible(false);
        controller.mapController.filterbarVisible(false);
        controller.messageContent("GPS error: Could not retrieve location");
      }

      function initLocationGpsError(error) {
        console.log("initLocationGpsError");
        GeoLocation.printError(error);
        controller.messageContent("GPS error: Initialization error; is the GPS enabled?");
      }

      controller = {
        mapController: MapController(updateLocationGpsError, initLocationGpsError),
        sidebarController: SidebarController(),
        messageContent: ko.observable(),
        addLocationController: {
          categories: [{
              name: 'landscape',
              icon: 'terrain'
            },
            {
              name: 'nature',
              icon: 'nature'
            },
            {
              name: 'dining',
              icon: 'local_dining'
            },
            {
              name: 'building',
              icon: 'account_balance'
            },
            {
              name: 'animal',
              icon: 'pets'
            },
            {
              name: 'sport',
              icon: 'directions_bike'
            },
          ], //, 'nature', 'dining', 'building', 'animal', 'sport'
          locationData: {
            category: ko.observable()
          },
          getCategoryIcon: function(category) {
            var result = "home";
            controller.addLocationController.categories.forEach(function(value) {
              if (value.name === category) {
                result = value.icon;
              }
            });
            if (result === "home") {
              console.error("Unknown category, no icon defined");
            }
            return result;
          },
          selectCategory: function(category) {
            return function() {
              controller.addLocationController.locationData.category(category);
              showPage("addLocationDetailsView");
            };
          },
          selectCategoryClosePanel: function(category) {
            return function() {
              controller.addLocationController.locationData.category(category);
              $("#changeCategoryCollapse").collapse('toggle');
            };
          },
          openPanelHandler: function() {
            var $this = $(this);
            $("[data-collapse-group='myDivs']:not([data-target='" + $this.data("target") + "'])").each(function() {
              $($(this).data("target")).collapse("hide");
            });
          },
          backToMap: function() {
            // Reset entered data
            controller.addLocationController.locationData.category(null);
            controller.addLocationController.locationData.position = null;
            showPage("mapView");
          },
          backToSelectCategory: function() {
            showPage("addLocationView");
          }
        }
      };

      ko.applyBindings(controller);

      controller.mapController.initMap();

      console.log("All done loading");

      //showPage("addLocationView")
      showPage("addLocationDetailsView");
      controller.addLocationController.locationData.category("nature");
    })(jQuery);
  </script>

</body>

</html>
